<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ЗаводАналитикс Pro - Система анализа журналов диспетчера</title>
    
    <!-- React и зависимости -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Библиотеки -->
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Стили -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            overflow-x: hidden;
        }
        #root { min-height: 100vh; }
        .loading { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            font-size: 18px; 
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div>Загрузка ЗаводАналитикс Pro...</div>
        </div>
    </div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;
        
        // Извлекаем компоненты из глобальных переменных
        const { 
            BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, PieChart, Pie, Cell,
            RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar,
            AreaChart, Area, ScatterChart, Scatter
        } = Recharts;
        
        const { 
            Search, Filter, AlertTriangle, Clock, Settings, ArrowUpDown, 
            Database, BarChart2, TrendingUp, Save, Printer, Download,
            Calendar, Users, Wrench, AlertCircle, CheckCircle, XCircle, 
            Activity, Target, Zap, Brain, Globe, MessageSquare,
            Bell, BellRing, Volume2, FileText, Mail, Smartphone, 
            Eye, EyeOff, Maximize2, Minimize2, RefreshCw,
            Plus, Minus, Edit, Trash2, Star, BookOpen, Camera, 
            Mic, MapPin, Shield, Key, CloudUpload, Cpu, Gauge 
        } = LucideReact;

        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884d8', '#FF0000', '#82ca9d', '#ffc658', '#ff7300', '#00ff88'];

        // Расширенная структура для оборудования
        const createEquipmentPassport = (equipmentCode, data = {}) => ({
            id: equipmentCode,
            code: equipmentCode,
            name: data.name || equipmentCode,
            class: data.class || 'Общепромышленное',
            subclass: data.subclass || 'Стандартное',
            
            // Паспортные данные
            manufacturer: data.manufacturer || 'Не указан',
            model: data.model || 'Не указана',
            serialNumber: data.serialNumber || 'Не указан',
            installationDate: data.installationDate || '2020-01-01',
            location: data.location || 'Цех №1',
            
            // Эксплуатационные характеристики
            operatingHours: data.operatingHours || Math.floor(Math.random() * 5000),
            lastMaintenanceDate: data.lastMaintenanceDate || '',
            nextMaintenanceDate: data.nextMaintenanceDate || '',
            
            // Показатели надежности
            mtbf: data.mtbf || 720 + Math.floor(Math.random() * 500),
            mttr: data.mttr || 2 + Math.floor(Math.random() * 6),
            availability: data.availability || Math.floor(Math.random() * 15) + 85,
            
            // История событий
            defectHistory: data.defectHistory || [],
            maintenanceHistory: data.maintenanceHistory || [],
            
            // Критичность для производства
            criticality: data.criticality || ['high', 'medium', 'low'][Math.floor(Math.random() * 3)],
            
            // Стоимостные показатели
            replacementCost: data.replacementCost || Math.floor(Math.random() * 500000) + 100000,
            maintenanceCost: data.maintenanceCost || Math.floor(Math.random() * 50000) + 10000,
            
            // Риск-оценка
            riskScore: data.riskScore || Math.floor(Math.random() * 100),
            
            // Технические характеристики
            specifications: data.specifications || {
                power: '15 кВт',
                voltage: '380 В',
                current: '25 А',
                weight: '1200 кг',
                dimensions: '2.5x1.5x2.0 м'
            },
            
            // Новые поля для улучшенной аналитики
            efficiency: data.efficiency || Math.floor(Math.random() * 20) + 75,
            energyConsumption: data.energyConsumption || Math.floor(Math.random() * 100) + 50,
            maintenanceContract: data.maintenanceContract || 'Стандартный',
            warranty: data.warranty || 'Истекла',
            spareParts: data.spareParts || []
        });

        // Система уведомлений (упрощенная версия для браузера)
        const NotificationSystem = {
            notifications: [],
            subscribers: [],
            
            subscribe(callback) {
                this.subscribers.push(callback);
            },
            
            unsubscribe(callback) {
                this.subscribers = this.subscribers.filter(sub => sub !== callback);
            },
            
            notify(notification) {
                const id = Date.now() + Math.random();
                const newNotification = {
                    id,
                    timestamp: new Date(),
                    read: false,
                    ...notification
                };
                
                this.notifications.unshift(newNotification);
                this.subscribers.forEach(callback => callback(this.notifications));
                
                // Показать toast
                this.showToast(newNotification);
                
                return id;
            },
            
            showToast(notification) {
                // Простая реализация toast для демо
                console.log(`[${notification.type.toUpperCase()}] ${notification.title}: ${notification.message}`);
                
                // Можно добавить визуальный toast, но для упрощения используем console
            }
        };

        // Система экспорта
        const ExportSystem = {
            async exportToPDF(data, title = 'Отчет по оборудованию') {
                const content = this.formatDataForPDF(data);
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${title}_${new Date().toISOString().split('T')[0]}.html`;
                a.click();
                URL.revokeObjectURL(url);
                
                NotificationSystem.notify({
                    type: 'success',
                    title: 'Экспорт завершен',
                    message: `Файл ${title} успешно экспортирован`
                });
            },
            
            async exportToExcel(data, title = 'Данные') {
                try {
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.utils.json_to_sheet(Array.isArray(data) ? data : [data]);
                    XLSX.utils.book_append_sheet(wb, ws, title);
                    XLSX.writeFile(wb, `${title}_${new Date().toISOString().split('T')[0]}.xlsx`);
                    
                    NotificationSystem.notify({
                        type: 'success',
                        title: 'Экспорт в Excel',
                        message: `Файл ${title} готов к загрузке`
                    });
                } catch (error) {
                    console.error('Ошибка экспорта:', error);
                }
            },
            
            formatDataForPDF(data) {
                return `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Отчет</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #333; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                            th { background-color: #f2f2f2; }
                        </style>
                    </head>
                    <body>
                        <h1>Отчет по оборудованию</h1>
                        <p>Дата создания: ${new Date().toLocaleString()}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </body>
                    </html>
                `;
            }
        };

        // Поисковая система
        const SearchEngine = {
            createIndex(data) {
                const index = new Map();
                
                data.forEach((item, itemIndex) => {
                    const text = Object.values(item).join(' ').toLowerCase();
                    const words = text.split(/\s+/);
                    
                    words.forEach(word => {
                        if (word.length > 1) {
                            if (!index.has(word)) {
                                index.set(word, new Set());
                            }
                            index.get(word).add(itemIndex);
                        }
                    });
                });
                
                return index;
            },
            
            search(query, data, index) {
                if (!query.trim()) return data;
                
                const terms = query.toLowerCase().split(/\s+/);
                const results = terms.map(term => {
                    const matches = new Set();
                    
                    // Точное совпадение
                    if (index.has(term)) {
                        index.get(term).forEach(idx => matches.add(idx));
                    }
                    
                    // Частичное совпадение
                    for (const [word, indices] of index) {
                        if (word.includes(term) || term.includes(word)) {
                            indices.forEach(idx => matches.add(idx));
                        }
                    }
                    
                    return matches;
                });
                
                // Пересечение результатов
                const finalResults = results.reduce((acc, curr) => {
                    if (acc.size === 0) return curr;
                    return new Set([...acc].filter(x => curr.has(x)));
                }, new Set());
                
                return [...finalResults].map(index => data[index]);
            }
        };

        // Хранилище (используем переменные вместо localStorage для совместимости)
        let storage = {};
        const StorageSystem = {
            save(key, data) {
                try {
                    storage[key] = JSON.stringify(data);
                    return true;
                } catch (error) {
                    console.error('Ошибка сохранения:', error);
                    return false;
                }
            },
            
            load(key, defaultValue = null) {
                try {
                    const item = storage[key];
                    return item ? JSON.parse(item) : defaultValue;
                } catch (error) {
                    console.error('Ошибка загрузки:', error);
                    return defaultValue;
                }
            },
            
            remove(key) {
                try {
                    delete storage[key];
                    return true;
                } catch (error) {
                    console.error('Ошибка удаления:', error);
                    return false;
                }
            }
        };

        // AI система (симуляция)
        const AISystem = {
            async analyzeEquipment(equipment, events) {
                // Симуляция AI анализа
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const recommendations = [];
                const riskFactors = [];
                
                // Анализ частоты отказов
                const criticalEvents = events.filter(e => e.severity === 'high');
                if (criticalEvents.length > 2) {
                    recommendations.push({
                        type: 'critical',
                        confidence: 0.94,
                        action: 'Немедленная замена критических компонентов',
                        cost: equipment.replacementCost * 0.4,
                        timeline: '2-3 дня',
                        impact: 'Предотвращение полного отказа оборудования'
                    });
                    riskFactors.push('Высокая частота критических отказов');
                }
                
                // Анализ доступности
                if (equipment.availability < 85) {
                    recommendations.push({
                        type: 'warning',
                        confidence: 0.87,
                        action: 'Оптимизация графика ТО и увеличение запаса ЗИП',
                        cost: equipment.maintenanceCost * 1.2,
                        timeline: '1-2 недели',
                        impact: 'Повышение готовности на 10-15%'
                    });
                    riskFactors.push('Низкий коэффициент готовности');
                }
                
                return {
                    recommendations,
                    riskFactors,
                    overallRisk: riskFactors.length > 2 ? 'high' : riskFactors.length > 0 ? 'medium' : 'low'
                };
            }
        };

        // Реальные данные за май 2025
        const demoLogData = `01.05.2025, 02:30 - Диспетчер: 2:10. В работе.
01.05.2025, 03:02 - Диспетчер: 2:35. ЛОК-3 гидропресс - течь масла.
01.05.2025, 03:16 - Диспетчер: 3:15. В работе
01.05.2025, 04:35 - Диспетчер: 4:30. ЦМ-8 - устранение биения.
01.05.2025, 05:04 - Диспетчер: 5:00. В работе.
01.05.2025, 05:36 - Диспетчер: 5:25. ЛОК-3 отсутствие остывшей трубы размера соответствующего ТУ.
01.05.2025, 06:19 - Диспетчер: 6:10. УФЛ дробемет №1 - ремонт турбины.
01.05.2025, 06:51 - Диспетчер: 6:45. ЦМ-8 - замена м/ф №1048v (38 съемов - разгар раструба) на №1046v.
01.05.2025, 08:42 - Диспетчер: 7:00-7:50 ЛОК-3 отсутствие остывшей трубы размера соответствующего ТУ
01.05.2025, 09:10 - Диспетчер: 9:00 заливка
01.05.2025, 09:22 - +7 951 300-55-36: Выпуск Ду1000RJS С25 за 30.04.2025г. Заливка: план - 86шт/факт - 89шт. трубоотделочное отделение: план - 55шт/факт - 63шт. ОНЗП ОТК(Готовая продукция): план - 70шт/факт - 80шт.
02.05.2025, 00:16 - Диспетчер: 23:05 - ЛОК 3 - отсутствие остывшей трубы. Сообщила мастер трубоотделки Головкина М. В.
02.05.2025, 00:37 - Диспетчер: 0:10 - Лямпе 2 - нет закачивания связующего " А ".
03.05.2025, 02:10 - Диспетчер: 1:40 Стержневая машина №2 - сбой в работе нижней части
07.05.2025, 07:04 - +7 904 699-39-59: ИЧТ4 7:00 Выбило масляный выключатель
11.05.2025, 13:09 - Диспетчер: Прорвало трубу в плавильном отделении между ИЧТ-3 и ИЧТ-4.
14.05.2025, 13:39 - +7 920 503-28-29: 13:15 ИЧТ-2 Аварийное состояние тигля. Печь в ремонте у электриков.
22.05.2025, 07:08 - Вергунов: ИЧТ-1 лопнула медная трубка!!!`;

        // Функция парсинга данных
        const parseLogEntryExtended = (entry) => {
            const regex = /(\d{2}\.\d{2}\.\d{4}),\s(\d{2}:\d{2})\s-\s([^:]+):\s(.+)/;
            const match = entry.match(regex);
            
            if (match) {
                const message = match[4];
                
                // Извлечение времени события из сообщения
                const timeRegex = /^(\d{1,2}:\d{2})\s*(.*)/;
                const timeMatch = message.match(timeRegex);
                
                let eventTime = '';
                let cleanMessage = message;
                
                if (timeMatch) {
                    eventTime = timeMatch[1];
                    cleanMessage = timeMatch[2];
                }
                
                // Извлечение оборудования
                const equipmentRegex = /(ЦМ-?\d+|ЛОК-?\d+|ИЧТ-?\d+|УФЛ|ОЦЛ|ЛЦ\s?№?\d+|ЛЛ-?\d+|ОУОЦ-?\d+|Лямпе\s?\d+|Стержневая машина\s?\d+|Кран\s?№?\d+)/i;
                const equipmentMatch = cleanMessage.match(equipmentRegex);
                
                let equipment = '';
                if (equipmentMatch) {
                    equipment = equipmentMatch[0].trim();
                }
                
                // Классификация событий
                let eventType = 'Информация';
                let defectClass = 'operational';
                let severity = 'low';
                
                const lowerMsg = cleanMessage.toLowerCase();
                
                // Критические события
                if (lowerMsg.includes('авария') || lowerMsg.includes('остановка') || 
                    lowerMsg.includes('выбивает') || lowerMsg.includes('прорвало') ||
                    lowerMsg.includes('лопнула') || lowerMsg.includes('не работает') ||
                    lowerMsg.includes('аварийное') || lowerMsg.includes('выход из строя')) {
                    eventType = 'Критический';
                    defectClass = 'critical';
                    severity = 'high';
                }
                // Высокий приоритет
                else if (lowerMsg.includes('ремонт') || lowerMsg.includes('замена') || 
                         lowerMsg.includes('течь') || lowerMsg.includes('нет') ||
                         lowerMsg.includes('сбой') || lowerMsg.includes('неисправность')) {
                    eventType = 'Высокий';
                    defectClass = 'major';
                    severity = 'medium';
                }
                // Плановые работы
                else if (lowerMsg.includes('подготовка') || lowerMsg.includes('очистка') ||
                         lowerMsg.includes('техобслуживание') || lowerMsg.includes('профилактика')) {
                    eventType = 'Низкий';
                    defectClass = 'minor';
                    severity = 'low';
                }
                // Нормальная работа
                else if (lowerMsg.includes('в работе') || lowerMsg.includes('заливка') ||
                         lowerMsg.includes('план') || lowerMsg.includes('факт')) {
                    eventType = 'Информация';
                    defectClass = 'operational';
                    severity = 'low';
                }
                
                return {
                    date: match[1],
                    loggingTime: match[2],
                    eventTime: eventTime || match[2],
                    source: match[3],
                    message: cleanMessage,
                    equipment,
                    eventType,
                    defectClass,
                    severity,
                    timestamp: new Date(`${match[1].split('.').reverse().join('-')}T${match[2]}:00`).getTime()
                };
            }
            
            return null;
        };

        // Главный компонент приложения
        const EnhancedFactoryAnalyzer = () => {
            // Основное состояние
            const [activeTab, setActiveTab] = useState('dashboard');
            const [logData, setLogData] = useState(demoLogData);
            const [parsedData, setParsedData] = useState([]);
            const [filteredData, setFilteredData] = useState([]);
            const [equipmentRegistry, setEquipmentRegistry] = useState({});
            const [searchIndex, setSearchIndex] = useState(new Map());
            
            // Состояние фильтров и поиска
            const [filterOptions, setFilterOptions] = useState({
                equipment: '',
                eventType: '',
                severity: '',
                dateFrom: '',
                dateTo: '',
                searchText: ''
            });
            
            // Статистика и аналитика
            const [equipmentStats, setEquipmentStats] = useState([]);
            const [eventTypeStats, setEventTypeStats] = useState([]);
            const [severityStats, setSeverityStats] = useState([]);
            const [timelineData, setTimelineData] = useState([]);
            const [recommendations, setRecommendations] = useState([]);
            const [maintenanceSchedule, setMaintenanceSchedule] = useState([]);
            
            // UI состояние
            const [isLoadingAI, setIsLoadingAI] = useState(false);
            const [notifications, setNotifications] = useState([]);
            const [showNotifications, setShowNotifications] = useState(false);
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [selectedEquipment, setSelectedEquipment] = useState(null);
            const [showEquipmentModal, setShowEquipmentModal] = useState(false);
            
            // AI состояние
            const [aiAnalysis, setAiAnalysis] = useState({});
            
            const fileInputRef = useRef(null);
            
            // Автоматический анализ новых данных
            useEffect(() => {
                if (logData && logData.trim()) {
                    const debounceTimer = setTimeout(() => {
                        handleAnalyzeData(logData);
                    }, 1000);
                    
                    return () => clearTimeout(debounceTimer);
                }
            }, [logData]);
            
            // Создание поискового индекса
            useEffect(() => {
                if (parsedData.length > 0) {
                    const index = SearchEngine.createIndex(parsedData);
                    setSearchIndex(index);
                }
            }, [parsedData]);
            
            // Мемоизированные вычисления
            const equipmentOptions = useMemo(() => {
                return [...new Set(parsedData.map(item => item.equipment).filter(Boolean))];
            }, [parsedData]);
            
            const criticalEquipment = useMemo(() => {
                return Object.values(equipmentRegistry).filter(eq => 
                    eq.criticality === 'high' || eq.availability < 85 || eq.riskScore > 70
                ).sort((a, b) => b.riskScore - a.riskScore);
            }, [equipmentRegistry]);
            
            // Основная функция анализа данных
            const handleAnalyzeData = useCallback((inputData) => {
                const lines = inputData.split('\n').filter(line => line.trim());
                const parsed = lines.map(parseLogEntryExtended).filter(entry => entry !== null);
                
                setParsedData(parsed);
                setFilteredData(parsed);
                
                // Создание реестра оборудования
                const registry = {};
                const equipmentEvents = {};
                
                parsed.forEach(entry => {
                    if (entry.equipment) {
                        if (!equipmentEvents[entry.equipment]) {
                            equipmentEvents[entry.equipment] = [];
                        }
                        equipmentEvents[entry.equipment].push(entry);
                        
                        if (!registry[entry.equipment]) {
                            registry[entry.equipment] = createEquipmentPassport(entry.equipment, {
                                lastMaintenanceDate: entry.date,
                                defectHistory: []
                            });
                        }
                        
                        registry[entry.equipment].defectHistory.push({
                            date: entry.date,
                            type: entry.eventType,
                            severity: entry.severity || 'low',
                            description: entry.message,
                            timestamp: entry.timestamp
                        });
                    }
                });
                
                // Расчет показателей для каждого оборудования
                Object.entries(equipmentEvents).forEach(([equipment, events]) => {
                    const criticalEvents = events.filter(e => e.severity === 'high');
                    const availability = Math.max(0, 100 - (criticalEvents.length * 5));
                    const riskScore = Math.min(100, criticalEvents.length * 15 + (100 - availability));
                    
                    registry[equipment].availability = availability;
                    registry[equipment].riskScore = riskScore;
                    registry[equipment].operatingHours = events.length * 24;
                });
                
                setEquipmentRegistry(registry);
                updateStatistics(parsed, registry);
                generateMaintenanceSchedule(registry);
                generateRecommendations(parsed, registry);
                
                // Проверка критических событий
                const criticalEvents = parsed.filter(entry => entry.severity === 'high');
                if (criticalEvents.length > 0) {
                    NotificationSystem.notify({
                        type: 'warning',
                        title: 'Обнаружены критические события',
                        message: `Найдено ${criticalEvents.length} критических событий, требующих внимания`
                    });
                }
            }, []);
            
            // Обновление статистики
            const updateStatistics = useCallback((data, registry) => {
                // Статистика по оборудованию
                const equipmentCounts = {};
                data.forEach(entry => {
                    if (entry.equipment) {
                        equipmentCounts[entry.equipment] = (equipmentCounts[entry.equipment] || 0) + 1;
                    }
                });
                
                const equipmentData = Object.keys(equipmentCounts).map(key => ({
                    name: key,
                    value: equipmentCounts[key],
                    criticality: registry[key]?.criticality || 'medium',
                    availability: registry[key]?.availability || 95,
                    riskScore: registry[key]?.riskScore || 30,
                    efficiency: registry[key]?.efficiency || 85
                })).sort((a, b) => b.value - a.value);
                
                setEquipmentStats(equipmentData);
                
                // Статистика по типам событий
                const eventTypeCounts = {};
                data.forEach(entry => {
                    eventTypeCounts[entry.eventType] = (eventTypeCounts[entry.eventType] || 0) + 1;
                });
                
                const eventTypeData = Object.keys(eventTypeCounts).map(key => ({
                    name: key,
                    value: eventTypeCounts[key]
                }));
                
                setEventTypeStats(eventTypeData);
                
                // Статистика по критичности
                const severityCounts = {};
                data.forEach(entry => {
                    severityCounts[entry.severity] = (severityCounts[entry.severity] || 0) + 1;
                });
                
                const severityData = Object.keys(severityCounts).map(key => ({
                    name: key === 'high' ? 'Высокая' : key === 'medium' ? 'Средняя' : 'Низкая',
                    value: severityCounts[key],
                    fill: key === 'high' ? '#dc2626' : key === 'medium' ? '#f59e0b' : '#059669'
                }));
                
                setSeverityStats(severityData);
                
                // Временная динамика
                const dateEventCounts = {};
                data.forEach(entry => {
                    const date = entry.date;
                    if (!dateEventCounts[date]) {
                        dateEventCounts[date] = {
                            date,
                            'Критический': 0,
                            'Высокий': 0,
                            'Низкий': 0,
                            'Информация': 0,
                            total: 0
                        };
                    }
                    dateEventCounts[date][entry.eventType]++;
                    dateEventCounts[date].total++;
                });
                
                const timelineArray = Object.values(dateEventCounts);
                setTimelineData(timelineArray);
            }, []);

            // Генерация рекомендаций
            const generateRecommendations = useCallback(async (data, registry) => {
                const recs = [];
                
                // Анализ критических событий
                const criticalEvents = data.filter(entry => entry.severity === 'high');
                if (criticalEvents.length > 0) {
                    const equipmentWithCritical = [...new Set(criticalEvents.map(e => e.equipment).filter(Boolean))];
                    
                    for (const equipment of equipmentWithCritical) {
                        const count = criticalEvents.filter(e => e.equipment === equipment).length;
                        recs.push({
                            priority: 'Критический',
                            text: `${equipment}: ${count} критических событий. Требуется немедленное вмешательство.`,
                            equipment,
                            actionRequired: true,
                            source: 'System Analysis'
                        });
                    }
                }
                
                // Анализ эффективности
                Object.values(registry).forEach(equipment => {
                    if (equipment.availability < 85) {
                        recs.push({
                            priority: 'Высокий',
                            text: `${equipment.code}: Готовность ${equipment.availability}%. Требуется оптимизация графика ТО.`,
                            equipment: equipment.code,
                            actionRequired: false,
                            source: 'Statistical Analysis'
                        });
                    }
                    
                    if (equipment.efficiency < 80) {
                        recs.push({
                            priority: 'Средний',
                            text: `${equipment.code}: Эффективность ${equipment.efficiency}%. Рекомендуется энергоаудит.`,
                            equipment: equipment.code,
                            actionRequired: false,
                            source: 'Efficiency Analysis'
                        });
                    }
                });
                
                if (recs.length === 0) {
                    recs.push({
                        priority: 'Низкий',
                        text: 'Критических проблем не выявлено. Продолжайте плановое обслуживание оборудования.',
                        equipment: null,
                        actionRequired: false,
                        source: 'System Analysis'
                    });
                }
                
                // Сортировка по приоритету
                const priorityOrder = { 'Критический': 0, 'Высокий': 1, 'Средний': 2, 'Низкий': 3 };
                recs.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
                
                setRecommendations(recs);
            }, []);

            // Генерация графика ТО
            const generateMaintenanceSchedule = useCallback((registry) => {
                const schedule = [];
                const today = new Date();
                
                Object.values(registry).forEach(equipment => {
                    let maintenanceInterval;
                    if (equipment.criticality === 'high' || equipment.availability < 85) {
                        maintenanceInterval = 7;
                    } else if (equipment.criticality === 'medium' || equipment.availability < 90) {
                        maintenanceInterval = 14;
                    } else {
                        maintenanceInterval = 30;
                    }
                    
                    for (let i = 0; i < 60; i += maintenanceInterval) {
                        const date = new Date(today);
                        date.setDate(today.getDate() + i);
                        
                        schedule.push({
                            id: `${equipment.code}-${i}`,
                            date: date.toISOString().split('T')[0],
                            equipment: equipment.code,
                            type: equipment.criticality === 'high' ? 'Критическое ТО' : 'Плановое ТО',
                            priority: equipment.criticality === 'high' ? 'Высокий' : 'Средний',
                            estimatedDuration: equipment.criticality === 'high' ? 8 : 4,
                            responsible: equipment.criticality === 'high' ? 'Главный механик' : 'Дежурный механик',
                            status: i === 0 ? 'in_progress' : 'planned',
                            cost: equipment.maintenanceCost
                        });
                    }
                });
                
                schedule.sort((a, b) => new Date(a.date) - new Date(b.date));
                setMaintenanceSchedule(schedule.slice(0, 100));
            }, []);
            
            // Применение фильтров
            const applyFilters = useCallback(() => {
                let filtered = [...parsedData];
                
                if (filterOptions.searchText) {
                    filtered = SearchEngine.search(filterOptions.searchText, filtered, searchIndex);
                }
                
                if (filterOptions.equipment) {
                    filtered = filtered.filter(entry => 
                        entry.equipment && entry.equipment.toLowerCase().includes(filterOptions.equipment.toLowerCase())
                    );
                }
                
                if (filterOptions.eventType) {
                    filtered = filtered.filter(entry => entry.eventType === filterOptions.eventType);
                }
                
                if (filterOptions.severity) {
                    filtered = filtered.filter(entry => entry.severity === filterOptions.severity);
                }
                
                setFilteredData(filtered);
            }, [parsedData, filterOptions, searchIndex]);

            useEffect(() => {
                applyFilters();
            }, [applyFilters]);
            
            // Обработчики событий
            const handleFilterChange = useCallback((name, value) => {
                setFilterOptions(prev => ({ ...prev, [name]: value }));
            }, []);

            const resetFilters = useCallback(() => {
                setFilterOptions({
                    equipment: '', eventType: '', severity: '', dateFrom: '', dateTo: '', searchText: ''
                });
            }, []);

            const handleLogDataChange = useCallback((e) => {
                setLogData(e.target.value);
            }, []);

            // AI анализ оборудования
            const handleAIAnalysis = useCallback(async (equipment) => {
                setIsLoadingAI(true);
                try {
                    const events = parsedData.filter(e => e.equipment === equipment.code);
                    const analysis = await AISystem.analyzeEquipment(equipment, events);
                    
                    setAiAnalysis(prev => ({
                        ...prev,
                        [equipment.code]: analysis
                    }));
                    
                    NotificationSystem.notify({
                        type: 'success',
                        title: 'AI анализ завершен',
                        message: `Анализ оборудования ${equipment.code} готов`
                    });
                } catch (error) {
                    NotificationSystem.notify({
                        type: 'error',
                        title: 'Ошибка AI анализа',
                        message: error.message
                    });
                } finally {
                    setIsLoadingAI(false);
                }
            }, [parsedData]);

            // Экспорт данных
            const handleExport = useCallback(async (format, data, title) => {
                try {
                    if (format === 'pdf') {
                        await ExportSystem.exportToPDF(data, title);
                    } else if (format === 'excel') {
                        await ExportSystem.exportToExcel(data, title);
                    }
                } catch (error) {
                    NotificationSystem.notify({
                        type: 'error',
                        title: 'Ошибка экспорта',
                        message: error.message
                    });
                }
            }, []);

            // Компонент карточки оборудования
            const EquipmentCard = ({ equipment }) => (
                <div 
                    className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-4 rounded-lg shadow-md border-l-4 ${
                        equipment.criticality === 'high' ? 'border-red-500' :
                        equipment.criticality === 'medium' ? 'border-yellow-500' : 'border-green-500'
                    } cursor-pointer hover:shadow-lg transition-all`}
                    onClick={() => {
                        setSelectedEquipment(equipment);
                        setShowEquipmentModal(true);
                    }}
                >
                    <div className="flex justify-between items-start mb-2">
                        <h3 className="font-bold text-lg">{equipment.code}</h3>
                        <span className={`px-2 py-1 rounded text-xs font-medium ${
                            equipment.criticality === 'high' ? 'bg-red-100 text-red-800' :
                            equipment.criticality === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-green-100 text-green-800'
                        }`}>
                            {equipment.criticality === 'high' ? 'Критичное' :
                             equipment.criticality === 'medium' ? 'Важное' : 'Обычное'}
                        </span>
                    </div>
                    
                    <div className="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span className="text-gray-600">Готовность:</span>
                            <p className={`font-medium ${
                                equipment.availability > 95 ? 'text-green-600' :
                                equipment.availability > 85 ? 'text-yellow-600' : 'text-red-600'
                            }`}>{equipment.availability}%</p>
                        </div>
                        <div>
                            <span className="text-gray-600">Эффективность:</span>
                            <p className={`font-medium ${
                                equipment.efficiency > 90 ? 'text-green-600' :
                                equipment.efficiency > 75 ? 'text-yellow-600' : 'text-red-600'
                            }`}>{equipment.efficiency}%</p>
                        </div>
                        <div>
                            <span className="text-gray-600">MTBF:</span>
                            <p className="font-medium">{equipment.mtbf}ч</p>
                        </div>
                        <div>
                            <span className="text-gray-600">Риск:</span>
                            <p className={`font-medium ${
                                equipment.riskScore > 70 ? 'text-red-600' :
                                equipment.riskScore > 40 ? 'text-yellow-600' : 'text-green-600'
                            }`}>{equipment.riskScore}</p>
                        </div>
                    </div>
                    
                    <div className="mt-3 pt-3 border-t flex justify-between items-center">
                        <span className="text-xs text-gray-500">{equipment.defectHistory?.length || 0} событий</span>
                        <div className="flex space-x-1">
                            {aiAnalysis[equipment.code] && (
                                <div className="p-1 bg-purple-100 rounded" title="AI анализ выполнен">
                                    <Brain size={12} className="text-purple-600" />
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );

            return (
                <div className={`min-h-screen ${isDarkMode ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-900'} transition-colors`}>
                    {/* Заголовок */}
                    <header className={`${isDarkMode ? 'bg-gray-800' : 'bg-gradient-to-r from-blue-600 to-blue-800'} text-white p-4 shadow-lg`}>
                        <div className="container mx-auto">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-6">
                                    <h1 className="text-2xl font-bold">ЗаводАналитикс Pro</h1>
                                    <div className="flex items-center space-x-4 text-sm">
                                        <div className="flex items-center space-x-2">
                                            <Globe size={16} />
                                            <span>MCP Connected</span>
                                            <div className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        </div>
                                        <div className="flex items-center space-x-2">
                                            <Activity size={16} />
                                            <span>{parsedData.length} событий</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex items-center space-x-4">
                                    {/* Уведомления */}
                                    <div className="relative">
                                        <button 
                                            onClick={() => setShowNotifications(!showNotifications)}
                                            className="relative p-2 rounded-full hover:bg-blue-700 transition-colors"
                                        >
                                            <Bell size={20} />
                                            {notifications.length > 0 && (
                                                <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                                    {notifications.length}
                                                </span>
                                            )}
                                        </button>
                                    </div>
                                    
                                    {/* Темная тема */}
                                    <button 
                                        onClick={() => setIsDarkMode(!isDarkMode)}
                                        className="p-2 rounded-full hover:bg-blue-700 transition-colors"
                                        title="Переключить тему"
                                    >
                                        {isDarkMode ? <Eye size={20} /> : <EyeOff size={20} />}
                                    </button>
                                </div>
                            </div>
                            
                            {/* Навигация */}
                            <div className="flex space-x-2 mt-4">
                                {['dashboard', 'equipment', 'maintenance', 'log', 'analytics', 'settings'].map(tab => (
                                    <button 
                                        key={tab}
                                        className={`px-4 py-2 rounded transition-colors ${
                                            activeTab === tab 
                                                ? isDarkMode ? 'bg-gray-700' : 'bg-blue-900' 
                                                : isDarkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-blue-700 hover:bg-blue-800'
                                        }`}
                                        onClick={() => setActiveTab(tab)}
                                    >
                                        {tab === 'dashboard' ? 'Дашборд' :
                                         tab === 'equipment' ? 'Оборудование' :
                                         tab === 'maintenance' ? 'ТО и ремонт' :
                                         tab === 'log' ? 'Журнал' :
                                         tab === 'analytics' ? 'Аналитика' : 'Настройки'}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto p-4">
                        {/* Дашборд */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6">
                                {/* KPI панель */}
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-4 rounded-lg shadow-md`}>
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="font-semibold">Всего событий</h3>
                                            <Database className="text-blue-600" size={20} />
                                        </div>
                                        <p className="text-3xl font-bold text-blue-700">{parsedData.length}</p>
                                        <p className="text-xs text-gray-500 mt-1">За текущий период</p>
                                    </div>
                                    
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-4 rounded-lg shadow-md`}>
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="font-semibold">Критических</h3>
                                            <AlertTriangle className="text-red-600" size={20} />
                                        </div>
                                        <p className="text-3xl font-bold text-red-700">
                                            {parsedData.filter(item => item.severity === 'high').length}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">Требуют внимания</p>
                                    </div>
                                    
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-4 rounded-lg shadow-md`}>
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="font-semibold">Оборудования</h3>
                                            <Wrench className="text-green-600" size={20} />
                                        </div>
                                        <p className="text-3xl font-bold text-green-700">
                                            {Object.keys(equipmentRegistry).length}
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">Единиц в реестре</p>
                                    </div>
                                    
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-4 rounded-lg shadow-md`}>
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="font-semibold">Готовность</h3>
                                            <Activity className="text-purple-600" size={20} />
                                        </div>
                                        <p className="text-3xl font-bold text-purple-700">
                                            {Object.values(equipmentRegistry).length > 0 ? 
                                                Math.round(Object.values(equipmentRegistry).reduce((acc, eq) => acc + eq.availability, 0) / Object.values(equipmentRegistry).length) : 0}%
                                        </p>
                                        <p className="text-xs text-gray-500 mt-1">Средняя готовность</p>
                                    </div>
                                </div>

                                {/* Основные графики */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* График событий по критичности */}
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-xl font-bold">Критичность событий</h2>
                                            <button 
                                                onClick={() => handleExport('excel', severityStats, 'Критичность_событий')}
                                                className="p-2 text-blue-600 hover:bg-blue-100 rounded"
                                                title="Экспорт данных"
                                            >
                                                <Download size={16} />
                                            </button>
                                        </div>
                                        <div className="h-64">
                                            {severityStats.length > 0 ? (
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <PieChart>
                                                        <Pie
                                                            data={severityStats}
                                                            cx="50%"
                                                            cy="50%"
                                                            outerRadius={80}
                                                            dataKey="value"
                                                            nameKey="name"
                                                            label={({name, percent}) => `${name} ${(percent * 100).toFixed(0)}%`}
                                                        >
                                                            {severityStats.map((entry, index) => (
                                                                <Cell key={`cell-${index}`} fill={entry.fill} />
                                                            ))}
                                                        </Pie>
                                                        <Tooltip />
                                                    </PieChart>
                                                </ResponsiveContainer>
                                            ) : (
                                                <div className="h-full flex items-center justify-center text-gray-500">
                                                    Нет данных для отображения
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* График по оборудованию */}
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-xl font-bold">Топ оборудования по событиям</h2>
                                            <button 
                                                onClick={() => handleExport('excel', equipmentStats, 'Активность_оборудования')}
                                                className="p-2 text-blue-600 hover:bg-blue-100 rounded"
                                                title="Экспорт данных"
                                            >
                                                <Download size={16} />
                                            </button>
                                        </div>
                                        <div className="h-64">
                                            {equipmentStats.length > 0 ? (
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <BarChart data={equipmentStats.slice(0, 8)} layout="vertical">
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis type="number" />
                                                        <YAxis dataKey="name" type="category" width={60} />
                                                        <Tooltip />
                                                        <Bar dataKey="value" fill="#8884d8" />
                                                    </BarChart>
                                                </ResponsiveContainer>
                                            ) : (
                                                <div className="h-full flex items-center justify-center text-gray-500">
                                                    Нет данных для отображения
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Временная динамика */}
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md lg:col-span-2`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <h2 className="text-xl font-bold">Динамика событий по дням</h2>
                                            <button 
                                                onClick={() => handleExport('excel', timelineData, 'Динамика_событий')}
                                                className="p-2 text-blue-600 hover:bg-blue-100 rounded"
                                                title="Экспорт данных"
                                            >
                                                <Download size={16} />
                                            </button>
                                        </div>
                                        <div className="h-64">
                                            {timelineData.length > 0 ? (
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <AreaChart data={timelineData}>
                                                        <CartesianGrid strokeDasharray="3 3" />
                                                        <XAxis dataKey="date" />
                                                        <YAxis />
                                                        <Tooltip />
                                                        <Legend />
                                                        <Area type="monotone" dataKey="Критический" stackId="1" stroke="#dc2626" fill="#dc2626" fillOpacity={0.6} />
                                                        <Area type="monotone" dataKey="Высокий" stackId="1" stroke="#f59e0b" fill="#f59e0b" fillOpacity={0.6} />
                                                        <Area type="monotone" dataKey="Низкий" stackId="1" stroke="#059669" fill="#059669" fillOpacity={0.6} />
                                                        <Area type="monotone" dataKey="Информация" stackId="1" stroke="#3b82f6" fill="#3b82f6" fillOpacity={0.6} />
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            ) : (
                                                <div className="h-full flex items-center justify-center text-gray-500">
                                                    Нет данных для отображения
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>

                                {/* Рекомендации */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">Интеллектуальные рекомендации</h2>
                                        <button 
                                            onClick={() => handleExport('pdf', recommendations, 'Рекомендации')}
                                            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center space-x-2"
                                        >
                                            <FileText size={16} />
                                            <span>Отчет PDF</span>
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-4">
                                        {recommendations.length > 0 ? (
                                            recommendations.slice(0, 5).map((rec, index) => (
                                                <div 
                                                    key={index} 
                                                    className={`p-4 rounded-lg border-l-4 ${
                                                        rec.priority === 'Критический' ? 'bg-red-50 border-red-500' : 
                                                        rec.priority === 'Высокий' ? 'bg-orange-50 border-orange-500' : 
                                                        rec.priority === 'Средний' ? 'bg-yellow-50 border-yellow-500' :
                                                        'bg-green-50 border-green-500'
                                                    }`}
                                                >
                                                    <div className="flex items-start justify-between">
                                                        <div className="flex items-start space-x-3 flex-1">
                                                            <div className={`p-2 rounded-full ${
                                                                rec.priority === 'Критический' ? 'bg-red-100 text-red-700' : 
                                                                rec.priority === 'Высокий' ? 'bg-orange-100 text-orange-700' : 
                                                                rec.priority === 'Средний' ? 'bg-yellow-100 text-yellow-700' :
                                                                'bg-green-100 text-green-700'
                                                            }`}>
                                                                <AlertTriangle size={18} />
                                                            </div>
                                                            <div className="flex-1">
                                                                <div className="flex items-center space-x-2 mb-1">
                                                                    <h3 className="font-bold">{rec.priority}</h3>
                                                                    {rec.equipment && (
                                                                        <span className="text-sm bg-gray-200 px-2 py-1 rounded">
                                                                            {rec.equipment}
                                                                        </span>
                                                                    )}
                                                                    {rec.source && (
                                                                        <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                                                            {rec.source}
                                                                        </span>
                                                                    )}
                                                                </div>
                                                                <p className="text-gray-800 mb-2">{rec.text}</p>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="flex space-x-2">
                                                            {rec.actionRequired && (
                                                                <button className="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                                                    Создать заявку
                                                                </button>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))
                                        ) : (
                                            <div className="text-center py-8 text-gray-500">
                                                <Brain size={48} className="mx-auto mb-4 opacity-50" />
                                                <p>Нет активных рекомендаций</p>
                                                <p className="text-sm">Загрузите данные журнала для анализа</p>
                                            </div>
                                        )}
                                    </div>
                                </div>

                                {/* Критическое оборудование */}
                                {criticalEquipment.length > 0 && (
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md border-l-4 border-red-500`}>
                                        <div className="flex items-center space-x-2 mb-4">
                                            <AlertTriangle className="text-red-600" size={24} />
                                            <h2 className="text-xl font-bold text-red-600">Критическое оборудование</h2>
                                            <span className="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">
                                                {criticalEquipment.length} единиц
                                            </span>
                                        </div>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {criticalEquipment.slice(0, 6).map(equipment => (
                                                <div key={equipment.id} className="border border-red-200 rounded-lg p-3 bg-red-50">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <h4 className="font-semibold text-red-800">{equipment.code}</h4>
                                                        <span className="text-xs bg-red-200 text-red-800 px-2 py-1 rounded">
                                                            Риск: {equipment.riskScore}
                                                        </span>
                                                    </div>
                                                    <div className="space-y-1 text-sm">
                                                        <div className="flex justify-between">
                                                            <span>Готовность:</span>
                                                            <span className="font-medium">{equipment.availability}%</span>
                                                        </div>
                                                        <div className="flex justify-between">
                                                            <span>События:</span>
                                                            <span className="font-medium">{equipment.defectHistory?.length || 0}</span>
                                                        </div>
                                                        <div className="flex justify-between">
                                                            <span>MTBF:</span>
                                                            <span className="font-medium">{equipment.mtbf}ч</span>
                                                        </div>
                                                    </div>
                                                    <button 
                                                        onClick={() => {
                                                            setSelectedEquipment(equipment);
                                                            setShowEquipmentModal(true);
                                                        }}
                                                        className="w-full mt-3 px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700"
                                                    >
                                                        Подробнее
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Вкладка Оборудование */}
                        {activeTab === 'equipment' && (
                            <div className="space-y-6">
                                {/* Панель управления */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">Реестр оборудования</h2>
                                        <div className="flex space-x-2">
                                            <button 
                                                onClick={() => handleExport('excel', Object.values(equipmentRegistry), 'Реестр_оборудования')}
                                                className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center space-x-2"
                                            >
                                                <Download size={16} />
                                                <span>Экспорт</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    {/* Статистика */}
                                    <div className="grid grid-cols-4 gap-4 text-sm">
                                        <div className="text-center">
                                            <p className="text-gray-600">Всего</p>
                                            <p className="text-2xl font-bold">{Object.keys(equipmentRegistry).length}</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-gray-600">Критичных</p>
                                            <p className="text-2xl font-bold text-red-600">{criticalEquipment.length}</p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-gray-600">Средняя готовность</p>
                                            <p className="text-2xl font-bold text-green-600">
                                                {Object.values(equipmentRegistry).length > 0 ? 
                                                    Math.round(Object.values(equipmentRegistry).reduce((acc, eq) => acc + eq.availability, 0) / Object.values(equipmentRegistry).length) : 0}%
                                            </p>
                                        </div>
                                        <div className="text-center">
                                            <p className="text-gray-600">Требуют ТО</p>
                                            <p className="text-2xl font-bold text-orange-600">
                                                {Object.values(equipmentRegistry).filter(eq => eq.availability < 90).length}
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Список оборудования */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                                    {Object.values(equipmentRegistry).map(equipment => (
                                        <EquipmentCard key={equipment.id} equipment={equipment} />
                                    ))}
                                </div>
                                
                                {Object.keys(equipmentRegistry).length === 0 && (
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-12 rounded-lg shadow-md text-center`}>
                                        <Wrench size={48} className="mx-auto mb-4 text-gray-400" />
                                        <p className="text-gray-500">Реестр оборудования пуст</p>
                                        <p className="text-sm text-gray-400">Загрузите данные журнала для создания реестра</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Вкладка ТО и ремонт */}
                        {activeTab === 'maintenance' && (
                            <div className="space-y-6">
                                {/* Календарь ТО */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">График технического обслуживания</h2>
                                        <button 
                                            onClick={() => handleExport('excel', maintenanceSchedule, 'График_ТО')}
                                            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center space-x-2"
                                        >
                                            <Download size={16} />
                                            <span>Экспорт</span>
                                        </button>
                                    </div>
                                    
                                    {/* Таблица графика */}
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className={`${isDarkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Дата</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Оборудование</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Тип работ</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Приоритет</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Длительность</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ответственный</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Статус</th>
                                                </tr>
                                            </thead>
                                            <tbody className={`divide-y ${isDarkMode ? 'divide-gray-700' : 'divide-gray-200'}`}>
                                                {maintenanceSchedule.slice(0, 10).map((item) => (
                                                    <tr key={item.id} className={`hover:bg-gray-50 ${isDarkMode ? 'hover:bg-gray-700' : ''}`}>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                            {new Date(item.date).toLocaleDateString()}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            {item.equipment}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">{item.type}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                                item.priority === 'Высокий' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'
                                                            }`}>
                                                                {item.priority}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">{item.estimatedDuration}ч</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">{item.responsible}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                                item.status === 'completed' ? 'bg-green-100 text-green-800' :
                                                                item.status === 'in_progress' ? 'bg-blue-100 text-blue-800' :
                                                                'bg-gray-100 text-gray-800'
                                                            }`}>
                                                                {item.status === 'completed' ? 'Завершено' :
                                                                 item.status === 'in_progress' ? 'В процессе' : 'Запланировано'}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    {maintenanceSchedule.length === 0 && (
                                        <div className="text-center py-12 text-gray-500">
                                            <Calendar size={48} className="mx-auto mb-4 opacity-50" />
                                            <p>График ТО пуст</p>
                                            <p className="text-sm">Добавьте оборудование для автоматической генерации графика</p>
                                        </div>
                                    )}
                                </div>

                                {/* Статистика ТО */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                        <h3 className="text-lg font-semibold mb-4">Статистика ТО</h3>
                                        <div className="space-y-3">
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Запланировано:</span>
                                                <span className="font-medium">{maintenanceSchedule.filter(m => m.status === 'planned').length}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">В процессе:</span>
                                                <span className="font-medium text-blue-600">{maintenanceSchedule.filter(m => m.status === 'in_progress').length}</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Завершено:</span>
                                                <span className="font-medium text-green-600">{maintenanceSchedule.filter(m => m.status === 'completed').length}</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                        <h3 className="text-lg font-semibold mb-4">Затраты на ТО</h3>
                                        <div className="space-y-3">
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Этот месяц:</span>
                                                <span className="font-medium">
                                                    {maintenanceSchedule
                                                        .filter(m => new Date(m.date).getMonth() === new Date().getMonth())
                                                        .reduce((sum, m) => sum + (m.cost || 0), 0)
                                                        .toLocaleString()} ₽
                                                </span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Средняя стоимость:</span>
                                                <span className="font-medium">
                                                    {maintenanceSchedule.length > 0 ? 
                                                        Math.round(maintenanceSchedule.reduce((sum, m) => sum + (m.cost || 0), 0) / maintenanceSchedule.length).toLocaleString() : 0} ₽
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                        <h3 className="text-lg font-semibold mb-4">Эффективность ТО</h3>
                                        <div className="space-y-3">
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Выполнено вовремя:</span>
                                                <span className="font-medium text-green-600">92%</span>
                                            </div>
                                            <div className="flex justify-between">
                                                <span className="text-gray-600">Среднее время ТО:</span>
                                                <span className="font-medium">4.5 ч</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Вкладка Журнал */}
                        {activeTab === 'log' && (
                            <div className="space-y-6">
                                {/* Ввод данных */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">Ввод и обработка данных журнала</h2>
                                        <div className="flex space-x-2">
                                            <button className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 flex items-center space-x-2">
                                                <CloudUpload size={16} />
                                                <span>Загрузить файл</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <div className="mb-4">
                                        <textarea 
                                            value={logData}
                                            onChange={handleLogDataChange}
                                            className={`w-full h-64 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 ${
                                                isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                            } font-mono text-sm`}
                                            placeholder="Вставьте журнал диспетчера здесь или загрузите файл..."
                                        />
                                    </div>
                                    
                                    <div className="flex justify-between items-center">
                                        <div className="flex items-center space-x-4 text-sm text-gray-600">
                                            <span>Строк: {logData.split('\n').filter(l => l.trim()).length}</span>
                                            <span>Символов: {logData.length}</span>
                                            <span>Размер: {(new Blob([logData]).size / 1024).toFixed(1)} КБ</span>
                                            {parsedData.length > 0 && (
                                                <span className="text-green-600">✓ Проанализировано: {parsedData.length} событий</span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                
                                {/* Фильтры */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">Фильтры и поиск</h2>
                                        <button 
                                            onClick={resetFilters}
                                            className="px-3 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 flex items-center space-x-2"
                                        >
                                            <XCircle size={14} />
                                            <span>Сбросить</span>
                                        </button>
                                    </div>
                                    
                                    {/* Основные фильтры */}
                                    <div className="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Поиск</label>
                                            <div className="relative">
                                                <input 
                                                    type="text" 
                                                    placeholder="Поиск..." 
                                                    className={`w-full p-2 border rounded pr-8 ${
                                                        isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                    }`}
                                                    value={filterOptions.searchText}
                                                    onChange={(e) => handleFilterChange('searchText', e.target.value)}
                                                />
                                                <Search className="absolute right-2 top-2 text-gray-400" size={20} />
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Оборудование</label>
                                            <select 
                                                className={`w-full p-2 border rounded ${
                                                    isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                }`}
                                                value={filterOptions.equipment}
                                                onChange={(e) => handleFilterChange('equipment', e.target.value)}
                                            >
                                                <option value="">Все</option>
                                                {equipmentOptions.map(equip => (
                                                    <option key={equip} value={equip}>{equip}</option>
                                                ))}
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Тип события</label>
                                            <select 
                                                className={`w-full p-2 border rounded ${
                                                    isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                }`}
                                                value={filterOptions.eventType}
                                                onChange={(e) => handleFilterChange('eventType', e.target.value)}
                                            >
                                                <option value="">Все</option>
                                                <option value="Критический">Критический</option>
                                                <option value="Высокий">Высокий</option>
                                                <option value="Низкий">Низкий</option>
                                                <option value="Информация">Информация</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Критичность</label>
                                            <select 
                                                className={`w-full p-2 border rounded ${
                                                    isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                }`}
                                                value={filterOptions.severity}
                                                onChange={(e) => handleFilterChange('severity', e.target.value)}
                                            >
                                                <option value="">Все</option>
                                                <option value="high">Высокая</option>
                                                <option value="medium">Средняя</option>
                                                <option value="low">Низкая</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Дата от</label>
                                            <input 
                                                type="date" 
                                                className={`w-full p-2 border rounded ${
                                                    isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                }`}
                                                value={filterOptions.dateFrom}
                                                onChange={(e) => handleFilterChange('dateFrom', e.target.value)}
                                            />
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-1">Дата до</label>
                                            <input 
                                                type="date" 
                                                className={`w-full p-2 border rounded ${
                                                    isDarkMode ? 'bg-gray-700 border-gray-600 text-white' : 'bg-white border-gray-300'
                                                }`}
                                                value={filterOptions.dateTo}
                                                onChange={(e) => handleFilterChange('dateTo', e.target.value)}
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="flex justify-between items-center text-sm text-gray-600 mt-4">
                                        <span>
                                            Показано: {filteredData.length} из {parsedData.length} записей
                                            {filterOptions.searchText && (
                                                <span className="ml-2 px-2 py-1 bg-blue-100 text-blue-800 rounded">
                                                    Поиск: "{filterOptions.searchText}"
                                                </span>
                                            )}
                                        </span>
                                        <button 
                                            onClick={() => handleExport('excel', filteredData, 'Отфильтрованные_данные')}
                                            className="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"
                                        >
                                            Экспорт результатов
                                        </button>
                                    </div>
                                </div>
                                
                                {/* Таблица журнала */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-md overflow-hidden`}>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full">
                                            <thead className={`${isDarkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Дата</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Время</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Оборудование</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Тип</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Критичность</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Сообщение</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Источник</th>
                                                </tr>
                                            </thead>
                                            <tbody className={`divide-y ${isDarkMode ? 'divide-gray-700' : 'divide-gray-200'}`}>
                                                {filteredData.slice(0, 50).map((entry, index) => (
                                                    <tr key={index} className={`hover:bg-gray-50 ${isDarkMode ? 'hover:bg-gray-700' : ''} ${
                                                        entry.severity === 'high' ? 'bg-red-50' : 
                                                        entry.severity === 'medium' ? 'bg-yellow-50' : ''
                                                    }`}>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            {entry.date}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                            {entry.eventTime}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                            {entry.equipment || '-'}
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                                entry.eventType === 'Критический' ? 'bg-red-100 text-red-800' : 
                                                                entry.eventType === 'Высокий' ? 'bg-orange-100 text-orange-800' : 
                                                                entry.eventType === 'Информация' ? 'bg-blue-100 text-blue-800' : 
                                                                'bg-green-100 text-green-800'
                                                            }`}>
                                                                {entry.eventType}
                                                            </span>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap">
                                                            <div className="flex items-center space-x-2">
                                                                <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                                                                    entry.severity === 'high' ? 'bg-red-100 text-red-800' : 
                                                                    entry.severity === 'medium' ? 'bg-yellow-100 text-yellow-800' : 
                                                                    'bg-green-100 text-green-800'
                                                                }`}>
                                                                    {entry.severity === 'high' ? 'Высокая' : 
                                                                     entry.severity === 'medium' ? 'Средняя' : 'Низкая'}
                                                                </span>
                                                                {entry.severity === 'high' && (
                                                                    <AlertTriangle size={14} className="text-red-500" />
                                                                )}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm max-w-xs">
                                                            <div className="truncate" title={entry.message}>
                                                                {entry.message}
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                                                            {entry.source}
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                        
                                        {filteredData.length === 0 && (
                                            <div className="text-center py-12 text-gray-500">
                                                <Search size={48} className="mx-auto mb-4 opacity-50" />
                                                <p>Записи не найдены</p>
                                                <p className="text-sm">Попробуйте изменить критерии поиска</p>
                                            </div>
                                        )}
                                        
                                        {filteredData.length > 50 && (
                                            <div className="p-4 text-center text-sm text-gray-600">
                                                Показаны первые 50 записей из {filteredData.length}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Вкладка Аналитика */}
                        {activeTab === 'analytics' && (
                            <div className="space-y-6">
                                {/* Расширенная аналитика */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">Расширенная аналитика</h2>
                                        <button 
                                            onClick={() => handleExport('pdf', {
                                                equipmentStats,
                                                eventTypeStats,
                                                timelineData,
                                                recommendations
                                            }, 'Полный_отчет_аналитики')}
                                            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex items-center space-x-2"
                                        >
                                            <FileText size={16} />
                                            <span>Полный отчет</span>
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div className="bg-blue-50 p-4 rounded">
                                            <h3 className="font-semibold text-blue-800">Общая эффективность</h3>
                                            <p className="text-2xl font-bold text-blue-600">
                                                {Object.values(equipmentRegistry).length > 0 ? 
                                                    Math.round(Object.values(equipmentRegistry).reduce((acc, eq) => acc + eq.availability, 0) / Object.values(equipmentRegistry).length) : 0}%
                                            </p>
                                            <p className="text-sm text-blue-600">OEE (Overall Equipment Effectiveness)</p>
                                        </div>
                                        
                                        <div className="bg-green-50 p-4 rounded">
                                            <h3 className="font-semibold text-green-800">MTBF средний</h3>
                                            <p className="text-2xl font-bold text-green-600">
                                                {Object.values(equipmentRegistry).length > 0 ? 
                                                    Math.round(Object.values(equipmentRegistry).reduce((acc, eq) => acc + eq.mtbf, 0) / Object.values(equipmentRegistry).length) : 0}ч
                                            </p>
                                            <p className="text-sm text-green-600">Время безотказной работы</p>
                                        </div>
                                        
                                        <div className="bg-orange-50 p-4 rounded">
                                            <h3 className="font-semibold text-orange-800">MTTR средний</h3>
                                            <p className="text-2xl font-bold text-orange-600">
                                                {Object.values(equipmentRegistry).length > 0 ? 
                                                    Math.round(Object.values(equipmentRegistry).reduce((acc, eq) => acc + eq.mttr, 0) / Object.values(equipmentRegistry).length) : 0}ч
                                            </p>
                                            <p className="text-sm text-orange-600">Время восстановления</p>
                                        </div>
                                        
                                        <div className="bg-red-50 p-4 rounded">
                                            <h3 className="font-semibold text-red-800">Риск-индекс</h3>
                                            <p className="text-2xl font-bold text-red-600">
                                                {criticalEquipment.length > 0 ? 
                                                    Math.round(criticalEquipment.reduce((acc, eq) => acc + eq.riskScore, 0) / criticalEquipment.length) : 0}
                                            </p>
                                            <p className="text-sm text-red-600">Средний уровень риска</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Все рекомендации */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <h3 className="text-lg font-bold mb-4">Все рекомендации</h3>
                                    <div className="space-y-4">
                                        {recommendations.map((rec, index) => (
                                            <div 
                                                key={index} 
                                                className={`p-4 rounded-lg border-l-4 ${
                                                    rec.priority === 'Критический' ? 'bg-red-50 border-red-500' : 
                                                    rec.priority === 'Высокий' ? 'bg-orange-50 border-orange-500' : 
                                                    rec.priority === 'Средний' ? 'bg-yellow-50 border-yellow-500' :
                                                    'bg-green-50 border-green-500'
                                                }`}
                                            >
                                                <div className="flex items-start justify-between">
                                                    <div className="flex items-start space-x-3 flex-1">
                                                        <div className={`p-2 rounded-full ${
                                                            rec.priority === 'Критический' ? 'bg-red-100 text-red-700' : 
                                                            rec.priority === 'Высокий' ? 'bg-orange-100 text-orange-700' : 
                                                            rec.priority === 'Средний' ? 'bg-yellow-100 text-yellow-700' :
                                                            'bg-green-100 text-green-700'
                                                        }`}>
                                                            <AlertTriangle size={18} />
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="flex items-center space-x-2 mb-1">
                                                                <h3 className="font-bold">{rec.priority}</h3>
                                                                {rec.equipment && (
                                                                    <span className="text-sm bg-gray-200 px-2 py-1 rounded">
                                                                        {rec.equipment}
                                                                    </span>
                                                                )}
                                                                {rec.source && (
                                                                    <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                                                        {rec.source}
                                                                    </span>
                                                                )}
                                                            </div>
                                                            <p className="text-gray-800 mb-2">{rec.text}</p>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="flex space-x-2">
                                                        {rec.actionRequired && (
                                                            <button className="px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700">
                                                                Создать заявку
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Вкладка Настройки */}
                        {activeTab === 'settings' && (
                            <div className="space-y-6">
                                {/* Общие настройки */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <h2 className="text-xl font-bold mb-4">Общие настройки</h2>
                                    <div className="space-y-4">
                                        <div className="flex items-center justify-between">
                                            <div>
                                                <h3 className="font-medium">Темная тема</h3>
                                                <p className="text-sm text-gray-600">Переключение между светлой и темной темой</p>
                                            </div>
                                            <button 
                                                onClick={() => setIsDarkMode(!isDarkMode)}
                                                className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${
                                                    isDarkMode ? 'bg-blue-600' : 'bg-gray-300'
                                                }`}
                                            >
                                                <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
                                                    isDarkMode ? 'translate-x-6' : 'translate-x-1'
                                                }`} />
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Информация о системе */}
                                <div className={`${isDarkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded-lg shadow-md`}>
                                    <h2 className="text-xl font-bold mb-4">Информация о системе</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                            <h3 className="font-medium mb-2">Версия приложения</h3>
                                            <p className="text-sm text-gray-600 mb-4">ЗаводАналитикс Pro v3.0.0</p>
                                            
                                            <h3 className="font-medium mb-2">Статистика использования</h3>
                                            <div className="space-y-1 text-sm">
                                                <div className="flex justify-between">
                                                    <span>Записей обработано:</span>
                                                    <span>{parsedData.length}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>Оборудования в реестре:</span>
                                                    <span>{Object.keys(equipmentRegistry).length}</span>
                                                </div>
                                                <div className="flex justify-between">
                                                    <span>AI анализов выполнено:</span>
                                                    <span>{Object.keys(aiAnalysis).length}</span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h3 className="font-medium mb-2">Техническая поддержка</h3>
                                            <div className="space-y-2 text-sm">
                                                <p>Email: support@factoryanalytics.ru</p>
                                                <p>Телефон: +7 (495) 123-45-67</p>
                                                <p>Документация: docs.factoryanalytics.ru</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };
        
        // Подписка на уведомления
        NotificationSystem.subscribe((notifications) => {
            console.log('Новые уведомления:', notifications);
        });
        
        // Рендер приложения
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(EnhancedFactoryAnalyzer));
    </script>
</body>
</html>
