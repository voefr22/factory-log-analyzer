<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ЗаводАналитикс - Система анализа журнала диспетчера">
    <meta name="theme-color" content="#2563eb">
    <title>ЗаводАналитикс - Анализ журнала диспетчера</title>
    
    <!-- Предзагрузка критических ресурсов -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="https://unpkg.com/react@18.2.0/umd/react.production.min.js" as="script">
    <link rel="preload" href="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" as="script">
    
    <!-- Стили -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
</head>
<body>
    <!-- Корневой элемент для React -->
    <div id="root">
        <div class="loading-screen">
            <div class="loading-spinner"></div>
            <p>Загрузка приложения...</p>
        </div>
    </div>
    
    <!-- Сообщение об ошибке -->
    <div id="error" class="error-container" style="display:none">
        <div class="error-content">
            <h3>Произошла ошибка</h3>
            <p id="error-message"></p>
            <p id="error-details"></p>
            <button onclick="document.getElementById('error').style.display='none'" class="error-close">
                Закрыть
            </button>
        </div>
    </div>
    
    <!-- Подключаем основные библиотеки -->
    <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" 
            integrity="sha384-8iBk79BHqMlbPedRBToVQxu92ZVBvRSYuVyquHL+WDxXsuTQ9qb3Iu2qstPG3zsw"
            crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"
            integrity="sha384-MO+oZf9HrZa9JqjdHRczOKnT74z1BEmnazg+HVxkz8KfwpEfLtQ3/Iol2XUsYOuM"
            crossorigin="anonymous"></script>
    
    <!-- Подключаем Recharts -->
    <script src="https://unpkg.com/recharts@2.7.2/umd/Recharts.min.js"
            integrity="sha384-9fZkXf13B02t2wSzaSla0TFO4h4j1Mvqf1H8ny9fvpl6mTl0nmtZ8F4o6BxU3Tzt"
            crossorigin="anonymous"></script>
    <script>
        window.Recharts = Recharts;
    </script>
    
    <!-- Подключаем Lucide -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"
            integrity="sha384-9fZkXf13B02t2wSzaSla0TFO4h4j1Mvqf1H8ny9fvpl6mTl0nmtZ8F4o6BxU3Tzt"
            crossorigin="anonymous"></script>
    <script>
        window.lucide = lucide;
        // Инициализация иконок
        if (window.lucide && window.lucide.createIcons) {
            window.lucide.createIcons();
        }
    </script>
    
    <!-- Babel для JSX -->
    <script src="https://unpkg.com/@babel/standalone@7.22.10/babel.min.js"
            integrity="sha384-9fZkXf13B02t2wSzaSla0TFO4h4j1Mvqf1H8ny9fvpl6mTl0nmtZ8F4o6BxU3Tzt"
            crossorigin="anonymous"></script>
    
    <!-- Обработка ошибок -->
    <script>
        // Глобальный обработчик ошибок
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('Ошибка:', message, 'в', source, ':', lineno);
            
            const errorDiv = document.getElementById('error');
            const errorMessage = document.getElementById('error-message');
            const errorDetails = document.getElementById('error-details');
            
            errorDiv.style.display = 'block';
            errorMessage.textContent = message;
            
            let details = [];
            if (source) details.push('Файл: ' + source);
            if (lineno) details.push('Строка: ' + lineno);
            if (error && error.stack) details.push('Стек: ' + error.stack);
            
            errorDetails.textContent = details.join(' | ');
            
            return true;
        };

        // Обработка необработанных промисов
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Необработанная ошибка промиса:', event.reason);
            
            const errorDiv = document.getElementById('error');
            const errorMessage = document.getElementById('error-message');
            const errorDetails = document.getElementById('error-details');
            
            errorDiv.style.display = 'block';
            errorMessage.textContent = event.reason.message || 'Произошла ошибка при выполнении операции';
            errorDetails.textContent = 'Тип: Необработанная ошибка промиса';
        });
    </script>
    
    <!-- Вспомогательные функции -->
    <script src="utils.js"></script>
    
    <!-- Компоненты приложения -->
    <script type="text/babel" data-presets="react" src="components/Dashboard.js"></script>
    <script type="text/babel" data-presets="react" src="components/LogViewer.js"></script>
    <script type="text/babel" data-presets="react" src="components/Analytics.js"></script>
    <script type="text/babel" data-presets="react" src="components/Settings.js"></script>
    
    <!-- Основное приложение -->
    <script type="text/babel" data-presets="react" src="app.js"></script>
</body>
</html>
